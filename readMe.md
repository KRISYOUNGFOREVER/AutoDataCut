# 自动数据增广工具

一个基于 Streamlit 的智能图片裁切工具，支持多种裁切模式和批量处理，专为数据增广和机器学习数据集准备而设计。

## 🚀 功能特性

### 核心功能
- **多种裁切模式**：支持按边长比例、按数量估算、自定义尺寸三种裁切方式
- **智能网格裁切**：自动计算最优裁切窗口和重叠比例
- **严格模式**：可选择只保留完整尺寸的裁片，确保数据一致性
- **宽高比保持**：支持按原图比例计算裁切窗口，避免图像变形
- **批量处理**：支持文件夹批量处理和单文件上传两种输入方式

### 高级特性
- **实时预览**：裁切前可预览效果，显示裁片数量和尺寸信息
- **缩略图展示**：批量处理时显示每个裁片的实际尺寸
- **智能命名**：原图保持原文件名，裁片按序号自动命名
- **内存优化**：逐张处理大批量图片，避免内存溢出
- **进度显示**：批量处理时显示实时进度条

## 📦 安装说明

### 环境要求
- Python 3.7+
- 推荐使用虚拟环境

### 快速安装

1. **克隆项目**
```bash
git clone https://github.com/your-username/auto-data-augmentation-tool.git
cd auto-data-augmentation-tool
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **运行应用**
```bash
streamlit run app.py
```

4. **访问应用**
打开浏览器访问：`http://localhost:8501`

## 🎯 使用指南

### 输入方式选择

**方式一：文件夹批量处理**
- 适合本地使用
- 选择包含图片的文件夹
- 支持 jpg、jpeg、png、bmp 格式

**方式二：文件上传**
- 适合网页部署使用
- 支持拖拽上传多个文件
- 默认上传限制：300MB

### 裁切模式详解

#### 1. 按边长比例
- **用途**：保持原图比例进行裁切
- **参数**：边长比例（如 0.5 表示裁切窗口为原图一半）
- **特点**：裁片尺寸随原图大小变化

#### 2. 按数量估算
- **用途**：指定期望的裁片数量
- **参数**：期望裁片数量
- **特点**：自动计算合适的窗口大小

#### 3. 自定义尺寸
- **用途**：精确控制裁片尺寸
- **参数**：宽度、高度（像素）
- **选项**：可选择跟随原图宽高比例

### 高级设置

**重叠比例**
- 控制相邻裁片的重叠程度
- 范围：0-0.9（0表示无重叠，0.9表示90%重叠）
- 影响最终裁片数量

**严格模式**
- 开启：只保留完整尺寸的裁片
- 关闭：边缘不完整的裁片也会保留
- 建议：数据集训练时开启，数据增广时可关闭

## 📁 项目结构

```
自动数据增广工具/
├── .streamlit/
│   └── config.toml          # Streamlit配置文件
├── app.py                   # 主应用程序
├── core/
│   ├── __init__.py
│   └── cropping.py          # 核心裁切算法
├── utils/
│   ├── __init__.py
│   ├── nms.py              # 非极大值抑制
│   ├── saliency.py         # 显著性检测
│   └── texture.py          # 纹理分析
├── output_crops/           # 输出目录
├── requirements.txt        # 依赖包列表
└── README.md              # 项目说明
```

## ⚙️ 配置说明

### 上传限制配置

编辑 `.streamlit/config.toml` 文件：

```toml
[server]
maxUploadSize = 300  # 最大上传大小(MB)
maxMessageSize = 300 # 最大消息大小(MB)
```

### 性能优化建议

**内存使用**
- 单张4K图片约占用50-100MB内存
- 建议一次处理不超过20张大图
- 大批量处理时建议分批进行

**处理速度**
- 图片尺寸越大，处理时间越长
- 裁片数量越多，处理时间越长
- 建议先用小图测试参数

## 🔧 开发说明

### 核心算法

**网格裁切算法** (`core/cropping.py`)
- `grid_tiles()`: 基础网格裁切
- `grid_tiles_strict()`: 严格模式裁切，自动补齐边缘
- `compute_window_size()`: 智能窗口尺寸计算

**工具函数** (`utils/`)
- `nms.py`: 非极大值抑制，用于去重
- `saliency.py`: 显著性检测，用于智能裁切
- `texture.py`: 纹理分析，用于质量评估

### 扩展开发

**添加新的裁切模式**
1. 在 `core/cropping.py` 中实现算法
2. 在 `app.py` 中添加UI控件
3. 更新预览和导出逻辑

**添加新的图像处理功能**
1. 在 `utils/` 目录下创建新模块
2. 实现相应的处理函数
3. 在主程序中集成调用

## 📊 使用示例

### 数据集准备场景
```
原图：1024x1024
模式：自定义尺寸
尺寸：512x512
重叠：0.2
严格模式：开启
结果：9张512x512的裁片
```

### 数据增广场景
```
原图：800x600
模式：按数量估算
数量：16
重叠：0.1
严格模式：关闭
结果：约16张不同尺寸的裁片
```

## 🐛 常见问题

**Q: 上传文件失败？**
A: 检查文件大小是否超过300MB限制，可在config.toml中调整

**Q: 裁片数量不符合预期？**
A: 在"按数量估算"模式下，实际数量可能因图片尺寸和重叠比例而略有差异

**Q: 内存不足？**
A: 减少一次处理的图片数量，或降低图片分辨率

**Q: 处理速度慢？**
A: 大图片处理较慢属正常现象，建议先用小图测试参数

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

1. Fork 本项目
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

## 📞 联系方式

如有问题或建议，请通过以下方式联系：

- 提交 [Issue](https://github.com/your-username/auto-data-augmentation-tool/issues)
- 发送邮件至：your-email@example.com

---

⭐ 如果这个项目对你有帮助，请给个星标支持！
        